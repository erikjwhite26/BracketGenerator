@using BlazorApp.Data
@inject FirebaseAuthService Auth

<MudDialog>
    <TitleContent>Reset Password</TitleContent>

    <DialogContent>
        <MudTextField @bind-Value="email"
                      Label="Email"
                      Variant="Variant.Outlined"
                      FullWidth="true"
                      Adornment="Adornment.Start"
                      AdornmentIcon="@Icons.Material.Filled.Email" />

        @if (!string.IsNullOrEmpty(error))
        {
            <MudAlert Severity="Severity.Error" Dense="true" Class="mt-2">
                @error
            </MudAlert>
        }
    </DialogContent>

    <DialogActions>
        <MudButton Color="Color.Primary"
                   Variant="Variant.Filled"
                   OnClick="SendReset">
            Send Reset Email
        </MudButton>

        <MudButton Color="Color.Default"
                   Variant="Variant.Text"
                   OnClick="Cancel">
            Cancel
        </MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter] 
    public MudDialogInstance MudDialog { get; set; }

    [Parameter] 
    public string Email { get; set; }

    private string email = "";
    private string error = "";

    protected override void OnInitialized()
    {
        email = Email ?? "";
    }

    private async Task SendReset()
    {
        try
        {
            await Auth.SendPasswordResetEmail(email);
            MudDialog.Close(DialogResult.Ok("A password reset email has been sent."));
        }
        catch (Exception ex)
        {
            error = HelperFunctions.GetFriendlyFirebaseAuthError(ex);
        }
    }

    private void Cancel() => MudDialog.Cancel();
}